<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IP çº¯å‡€åº¦ä¸å½’å±åœ°æŸ¥è¯¢</title>
<!-- å›¾æ ‡åº“ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<!-- åœ°å›¾æ ·å¼ -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
:root {
  --primary: #00e676;
  --danger: #ff5252;
  --warn: #ffab00;
  --info: #2979ff;
  --bg: #0d1117;
  --card-bg: #1e1e1e;
  --text: #fff;
  --border: #333;
}
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  padding: 20px;
  margin: 0;
  box-sizing: border-box;
}
header {
  text-align: center;
  font-size: 1.8rem;
  color: var(--primary);
  font-weight: 700;
  margin-bottom: 20px;
  text-shadow: 0 0 10px rgba(0, 230, 118, 0.3);
}
.container {
  max-width: 800px;
  width: 100%;
  margin: 0 auto;
}
.card {
  background-color: var(--card-bg);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  border: 1px solid var(--border);
  transition: transform 0.2s;
}
.card:hover { transform: translateY(-2px); border-color: #555; }

.card h2 {
  margin-top: 0;
  margin-bottom: 15px;
  color: var(--primary);
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  border-bottom: 1px solid var(--border);
  padding-bottom: 10px;
}
.card h2 span { margin-right: 10px; }

/* è¾“å…¥åŒº */
.input-group { display: flex; gap: 10px; margin-bottom: 15px; }
input {
  flex: 1;
  padding: 12px;
  border-radius: 6px;
  border: 1px solid #444;
  background-color: #111;
  color: #eee;
  font-size: 15px;
  outline: none;
}
input:focus { border-color: var(--primary); }
button {
  padding: 0 20px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background-color: #2ea043;
  color: #fff;
  font-weight: 600;
  font-size: 15px;
  transition: 0.3s;
}
button:hover { background-color: #3fb950; }
button:disabled { background-color: #555; cursor: not-allowed; }

/* è¯¦ç»†ä¿¡æ¯å¸ƒå±€ */
.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  font-size: 15px;
  line-height: 1.6;
}
.info-item {
  background: #252525;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #333;
}
.info-label { color: #888; font-size: 12px; display: block; margin-bottom: 4px; }
.info-value { font-weight: 500; color: #fff; word-break: break-all; }

/* æ ‡ç­¾æ ·å¼ */
.badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: bold;
  margin-left: 5px;
  vertical-align: middle;
}
.badge-green { background: rgba(0, 230, 118, 0.15); color: var(--primary); border: 1px solid rgba(0, 230, 118, 0.3); }
.badge-red { background: rgba(255, 82, 82, 0.15); color: var(--danger); border: 1px solid rgba(255, 82, 82, 0.3); }
.badge-blue { background: rgba(41, 121, 255, 0.15); color: var(--info); border: 1px solid rgba(41, 121, 255, 0.3); }

/* çº¯å‡€åº¦æ£€æµ‹ä¸“åŒº */
.risk-report {
  margin-top: 15px;
  padding: 15px;
  background: #161b22;
  border: 1px solid #333;
  border-radius: 8px;
}
.risk-btns {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}
.risk-btn {
  flex: 1;
  padding: 8px;
  text-align: center;
  background: #333;
  color: #ccc;
  text-decoration: none;
  border-radius: 4px;
  font-size: 13px;
  transition: 0.2s;
  border: 1px solid transparent;
}
.risk-btn:hover { background: #444; color: #fff; border-color: #666; }

/* åœ°å›¾ */
#map { height: 200px; width: 100%; border-radius: 8px; margin-top: 15px; z-index: 1; }

.loading {
  display: inline-block;
  width: 16px; height: 16px;
  border: 2px solid var(--primary);
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 1s linear infinite;
  vertical-align: middle;
}
@keyframes spin { to { transform: rotate(360deg); } }

footer { text-align: center; margin-top: auto; color: #666; font-size: 13px; padding: 20px 0; }
.flag { height: 14px; margin-left: 5px; border-radius: 2px; }
</style>
</head>
<body>

<header><i class="fa-solid fa-shield-halved"></i> IP çº¯å‡€åº¦æ£€æµ‹</header>

<div class="container">
  
  <!-- å½“å‰ IP -->
  <div class="card">
    <h2><span>ğŸ“</span> æˆ‘çš„ç½‘ç»œç¯å¢ƒ</h2>
    <div id="myIpContent">
      <div class="info-value">æŸ¥è¯¢ä¸­... <span class="loading"></span></div>
    </div>
  </div>

  <!-- æŸ¥è¯¢å·¥å…· -->
  <div class="card">
    <h2><span>ğŸ”</span> ä¸“ä¸šæŸ¥è¯¢</h2>
    <div class="input-group">
      <input type="text" id="ipInput" placeholder="è¾“å…¥ IP åœ°å€ (ä¾‹å¦‚ 1.1.1.1)">
      <button id="searchBtn" onclick="manualQuery()">æŸ¥è¯¢</button>
    </div>
    
    <!-- ç»“æœå±•ç¤ºåŒº -->
    <div id="resultArea" style="display:none;">
      <div class="info-grid" id="resultGrid"></div>
      
      <!-- çº¯å‡€åº¦åˆ†ææ¨¡å— -->
      <div class="risk-report">
        <div class="info-label"><i class="fa-solid fa-server"></i> ç±»å‹ä¸çº¯å‡€åº¦æ¨æ–­</div>
        <div class="info-value" id="riskValue" style="font-size: 1.1rem; margin: 5px 0;">
          åˆ†æä¸­...
        </div>
        <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
          * åŸºäº ISP/ASN çš„é™æ€æ¨æ–­ï¼Œä»…ä¾›å‚è€ƒã€‚
        </div>
        
        <div class="info-label">æ·±åº¦é£é™©æ£€æµ‹ (ç‚¹å‡»è·³è½¬å¤–éƒ¨å·¥å…·):</div>
        <div class="risk-btns">
          <a href="#" id="linkScamalytics" target="_blank" class="risk-btn"><i class="fa-solid fa-lock"></i> Scamalytics (æ¬ºè¯ˆåˆ†)</a>
          <a href="#" id="linkWhoer" target="_blank" class="risk-btn"><i class="fa-solid fa-user-secret"></i> Whoer (ä¼ªè£…åº¦)</a>
          <a href="#" id="linkBgP" target="_blank" class="risk-btn"><i class="fa-solid fa-network-wired"></i> BGP.he.net</a>
        </div>
      </div>

      <div id="map"></div>
    </div>
  </div>

  <div class="card">
    <h2><span>ğŸ–¥ï¸</span> æœ¬æœºæŒ‡çº¹</h2>
    <div class="info-grid" id="deviceInfo"></div>
  </div>
</div>

<footer>
  IP Data by ipapi.co & OpenStreetMap<br>
  è”ç³»æˆ‘: <a href="mailto:abc@donluox.dpdns.org" style="color:var(--primary)">abc@donluox.dpdns.org</a>
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// --- æ ¸å¿ƒé€»è¾‘ï¼šIP ç±»å‹åˆ¤æ–­ ---
function analyzeIpType(isp, org, asn) {
  const text = (isp + " " + org + " " + asn).toLowerCase();
  
  // 1. æ•°æ®ä¸­å¿ƒ/æœºæˆ¿å…³é”®è¯ (é«˜é£é™©/éåŸç”Ÿ)
  const dcKeywords = [
    'cloud', 'hosting', 'vps', 'server', 'data center', 'datacenter', 'solution',
    'amazon', 'aws', 'google', 'microsoft', 'azure', 'oracle', 'digitalocean', 'linode', 'vultr',
    'alibaba', 'tencent', 'huawei', 'ucloud', 'choopa', 'hetzner', 'ovh', 'm247', 'leaseweb',
    'zenlayer', 'host', 'technology', 'network', 'm247', 'xtom', 'misaka', 'kirino'
  ];

  // 2. ä½å®…/ISP å…³é”®è¯ (ä½é£é™©/åŸç”Ÿ)
  const resKeywords = [
    'telecom', 'cable', 'dsl', 'fiber', 'broadband', 'internet', 'mobile', 'wireless',
    'comcast', 'verizon', 'at&t', 'spectrum', 'virgin', 'vodafone', 't-mobile', 'orange',
    'china telecom', 'china unicom', 'china mobile', 'hkt', 'pccw', 'chungu', 'kt corporation'
  ];

  let type = "æœªçŸ¥ç±»å‹";
  let riskLevel = "medium"; // low, medium, high
  let desc = "æ— æ³•ç¡®å®š";

  // ä¼˜å…ˆåŒ¹é…æœºæˆ¿ï¼Œå› ä¸ºæœºæˆ¿ç‰¹å¾æœ€æ˜æ˜¾
  const isDC = dcKeywords.some(kw => text.includes(kw));
  const isRes = resKeywords.some(kw => text.includes(kw));

  if (isDC) {
    type = "ğŸ¢ æ•°æ®ä¸­å¿ƒ (Data Center)";
    riskLevel = "high";
    desc = "è¯¥ IP å±äºæœºæˆ¿æˆ–äº‘æœåŠ¡å•†ï¼Œé€šå¸¸ç”¨äº VPN/ä»£ç†ï¼Œæµåª’ä½“è§£é”å¯èƒ½å—é™ã€‚";
  } else if (isRes) {
    type = "ğŸ  ä½å®… ISP (Residential)";
    riskLevel = "low";
    desc = "è¯¥ IP çœ‹èµ·æ¥æ˜¯åŸç”Ÿå®½å¸¦æˆ–ç§»åŠ¨ç½‘ç»œï¼Œçº¯å‡€åº¦é€šå¸¸è¾ƒé«˜ã€‚";
  } else {
    type = "ğŸ¢ ä¼ä¸š/ç»„ç»‡ (Business/Org)";
    riskLevel = "medium";
    desc = "å¯èƒ½æ˜¯ä¼ä¸šä¸“çº¿æˆ–å°å‹æœåŠ¡å•†ï¼Œæ€§è´¨ä»‹äºä½å®…å’Œæœºæˆ¿ä¹‹é—´ã€‚";
  }

  return { type, riskLevel, desc };
}

// --- æ¸²æŸ“ HTML ---
function renderResult(data, containerId, isFullMode = false) {
  const container = document.getElementById(containerId);
  
  // åˆ†æ IP ç±»å‹
  const analysis = analyzeIpType(data.org || '', data.isp || '', data.asn || '');
  
  // æ„å»ºåŸºç¡€ä¿¡æ¯
  const flag = data.country_code ? `<img class="flag" src="https://flagcdn.com/24x18/${data.country_code.toLowerCase()}.png">` : '';
  
  let html = '';
  
  if (!isFullMode) {
    // ç®€ç•¥æ¨¡å¼ (é¡¶éƒ¨å¡ç‰‡)
    html = `
      <div style="font-size:1.4rem; font-weight:bold; color:var(--primary); margin-bottom:10px;">
        ${data.ip} <span class="badge badge-${analysis.riskLevel === 'high' ? 'red' : 'green'}">${analysis.riskLevel === 'high' ? 'æœºæˆ¿' : 'ä½å®…'}</span>
      </div>
      <div style="font-size:0.95rem;">
        ${flag} ${data.country_name || ''} ${data.region || ''} ${data.city || ''} <br>
        <span style="color:#888;">${data.org || data.isp}</span>
      </div>
    `;
    container.innerHTML = html;
  } else {
    // è¯¦ç»†æ¨¡å¼ (æœç´¢ç»“æœ)
    container.innerHTML = `
      <div class="info-item">
        <span class="info-label">IP åœ°å€</span>
        <div class="info-value">${data.ip}</div>
      </div>
      <div class="info-item">
        <span class="info-label">åœ°ç†ä½ç½®</span>
        <div class="info-value">${flag} ${data.country_name} - ${data.city}</div>
      </div>
      <div class="info-item">
        <span class="info-label">è¿è¥å•† (ISP)</span>
        <div class="info-value">${data.isp || data.org}</div>
      </div>
      <div class="info-item">
        <span class="info-label">ASN / ç»„ç»‡</span>
        <div class="info-value">${data.asn} / ${data.org}</div>
      </div>
      <div class="info-item">
        <span class="info-label">æ—¶åŒº</span>
        <div class="info-value">${data.timezone}</div>
      </div>
      <div class="info-item">
        <span class="info-label">ç»çº¬åº¦</span>
        <div class="info-value">${data.latitude}, ${data.longitude}</div>
      </div>
    `;

    // æ›´æ–°é£é™©æŠ¥å‘ŠåŒºåŸŸ
    const riskEl = document.getElementById('riskValue');
    let badgeClass = 'badge-blue';
    if (analysis.riskLevel === 'high') badgeClass = 'badge-red';
    if (analysis.riskLevel === 'low') badgeClass = 'badge-green';

    riskEl.innerHTML = `
      <span class="badge ${badgeClass}" style="font-size:14px; margin-left:0;">${analysis.type}</span>
      <div style="margin-top:8px; font-size:14px; color:#ccc;">${analysis.desc}</div>
    `;

    // æ›´æ–°å¤–éƒ¨é“¾æ¥
    document.getElementById('linkScamalytics').href = `https://scamalytics.com/ip/${data.ip}`;
    document.getElementById('linkWhoer').href = `https://whoer.net/check?host=${data.ip}`;
    document.getElementById('linkBgP').href = `https://bgp.he.net/ip/${data.ip}`;

    // æ›´æ–°åœ°å›¾
    if (data.latitude && data.longitude) updateMap(data.latitude, data.longitude, data.city);
  }
}

// --- æ•°æ®è·å– ---
async function fetchInfo(ip, containerId, isFullMode) {
  const el = document.getElementById(containerId);
  if(!ip && !isFullMode) el.innerHTML = 'æŸ¥è¯¢ä¸­... <span class="loading"></span>';
  
  try {
    const url = ip ? `https://ipapi.co/${ip}/json/` : 'https://ipapi.co/json/';
    const res = await fetch(url);
    if (!res.ok) throw new Error("API è¯·æ±‚é™åˆ¶");
    const data = await res.json();
    
    if (data.error) throw new Error(data.reason || "IP æ— æ•ˆ");
    
    renderResult(data, containerId, isFullMode);
    
    if (isFullMode) {
        document.getElementById('resultArea').style.display = 'block';
        // å»¶è¿Ÿåˆ·æ–°åœ°å›¾é˜²æ­¢æ¸²æŸ“é”™è¯¯
        setTimeout(() => map && map.invalidateSize(), 200);
    }

  } catch (err) {
    el.innerHTML = `<div style="color:var(--danger)">æŸ¥è¯¢å¤±è´¥: ${err.message}<br><small>å¦‚æœæ˜¯å›½å†…ç½‘ç»œï¼Œå¯èƒ½æ— æ³•è¿æ¥ ipapi.coï¼Œå»ºè®®å¼€å¯ä»£ç†ã€‚</small></div>`;
  }
}

// --- åœ°å›¾é€»è¾‘ ---
let map = null, marker = null;
function updateMap(lat, lon, text) {
  if (!map) {
    map = L.map('map').setView([lat, lon], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);
  } else {
    map.setView([lat, lon], 13);
  }
  if (marker) map.removeLayer(marker);
  marker = L.marker([lat, lon]).addTo(map).bindPopup(text).openPopup();
}

// --- äº¤äº’é€»è¾‘ ---
function manualQuery() {
  const ip = document.getElementById('ipInput').value.trim();
  if (!ip) return alert('è¯·è¾“å…¥ IP');
  const btn = document.getElementById('searchBtn');
  btn.disabled = true; btn.innerText = "æŸ¥è¯¢ä¸­...";
  
  fetchInfo(ip, 'resultGrid', true).then(() => {
    btn.disabled = false; btn.innerText = "æŸ¥è¯¢";
  });
}

// å›è½¦æŸ¥è¯¢
document.getElementById('ipInput').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') manualQuery();
});

// è®¾å¤‡æŒ‡çº¹
function loadDevice() {
  const ua = navigator.userAgent;
  document.getElementById('deviceInfo').innerHTML = `
    <div class="info-item"><span class="info-label">æµè§ˆå™¨ UA</span><div class="info-value" style="font-size:12px;">${ua}</div></div>
    <div class="info-item"><span class="info-label">å±å¹•åˆ†è¾¨ç‡</span><div class="info-value">${screen.width} x ${screen.height}</div></div>
    <div class="info-item"><span class="info-label">å¹³å°/ç³»ç»Ÿ</span><div class="info-value">${navigator.platform}</div></div>
    <div class="info-item"><span class="info-label">è¯­è¨€</span><div class="info-value">${navigator.language}</div></div>
  `;
}

// åˆå§‹åŒ–
loadDevice();
fetchInfo(null, 'myIpContent', false);

</script>
</body>
</html>
