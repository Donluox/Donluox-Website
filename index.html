<!DOCTYPE html>
<html lang="zh">
<head>
  <!--
    What Is My IP - ç¨³å®šã€å¯è¯»ã€å¸¦çº¯å‡€åº¦ä¸æœºæˆ¿è¯†åˆ«çš„ç‰ˆæœ¬
    è¯´æ˜ï¼š
    1) å®Œæ•´æ³¨é‡Š + æ¨¡å—åŒ–å‡½æ•°ï¼Œå†—ä½™ä½†æ›´ç¨³å¦¥æ˜“ç»´æŠ¤ã€‚
    2) ä»…å‰ç«¯å®ç°ï¼šä½¿ç”¨ ipify + ipapi.co + AbuseIPDBï¼ˆéœ€è¦ä½ çš„ API Keyï¼‰ã€‚
    3) æ³¨æ„ï¼šæŠŠ AbuseIPDB Key æ”¾åœ¨å‰ç«¯ä¼šæš´éœ²ç»™æ‰€æœ‰è®¿å®¢ï¼Œä»…é™è‡ªç”¨/æµ‹è¯•ã€‚
  -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>What Is My IP</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- ===================== å…¨å±€æ ·å¼ï¼ˆä¿æŒå®Œæ•´ï¼Œä¸åšå‹ç¼©ï¼‰ ===================== -->
  <style>
    /* é¡µé¢åŸºç¡€ */
    body {
      background-color: #111;           /* æ·±è‰²èƒŒæ™¯æå‡å¯¹æ¯”åº¦ */
      color: #fff;                      /* æ–‡å­—ç»Ÿä¸€ç™½è‰² */
      font-family: 'Segoe UI', sans-serif;
      padding: 30px;                    /* å†…å®¹ç•™ç™½ */
      display: flex;                    /* ä¿æŒ footer åº•éƒ¨ */
      flex-direction: column;
      min-height: 100vh;
    }

    /* é¡¶éƒ¨æ ‡é¢˜ */
    header {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 700;
      color: #00e676;                   /* å“ç‰Œç»¿è‰² */
      margin-bottom: 30px;
      user-select: none;
      letter-spacing: 0.1em;
      text-shadow: 0 0 8px #00e676aa;   /* è½»å¾®å‘å…‰æ•ˆæœ */
    }

    /* å¡ç‰‡å®¹å™¨ï¼šç”¨äºæ¨¡å—åˆ†åŒº */
    .card {
      background-color: #1e1e1e;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.05);
      transition: all 0.4s ease-in-out;
      animation: fadeIn 0.6s ease;
    }

    /* æ‚¬æµ®å¾®åŠ¨æ•ˆï¼ˆå¯å»é™¤ï¼Œä¸å½±å“åŠŸèƒ½ï¼‰ */
    .card:hover {
      transform: scale(1.01);
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
    }

    /* è¾“å…¥æ¡†æ ·å¼ */
    .input-group { margin-bottom: 20px; }
    input[type="text"] {
      width: 100%;
      padding: 10px 15px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      outline: none;
      background-color: #222;
      color: #eee;
    }

    /* æŒ‰é’®æ ·å¼ */
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #00c853;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: #fff;
      transition: background 0.3s ease;
    }
    button:hover { background-color: #00e676; }

    /* ä¿¡æ¯å—æ–‡å­—è¡Œè· */
    .info span {
      display: block;
      margin-top: 10px;
      font-size: 16px;
    }

    /* å›¾æ ‡å’Œå›½æ—— */
    .icon { font-size: 18px; margin-right: 6px; }
    .flag {
      width: 24px;
      height: 16px;
      vertical-align: middle;
      margin-left: 6px;
      border-radius: 2px;
      box-shadow: 0 0 3px rgba(0,0,0,0.3);
    }

    /* æŸ¥è¯¢å†å² */
    .history-list {
      margin-top: 10px;
      font-size: 14px;
      color: #aaa;
    }
    .history-list span {
      cursor: pointer;
      color: #00e676;
      margin-right: 12px;
      user-select: none;
    }
    .history-list span:hover { text-decoration: underline; }

    /* åŠ è½½åŠ¨ç”» */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #00e676;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
      vertical-align: middle;
      margin-left: 10px;
    }

    /* çº¯å‡€åº¦æ¡ - å®¹å™¨ */
    .purity-bar {
      width: 100%;
      height: 14px;
      border-radius: 8px;
      background: #2a2a2a;             /* èƒŒæ™¯æ§½ */
      overflow: hidden;
      margin-top: 8px;
      border: 1px solid #333;
    }

    /* çº¯å‡€åº¦æ¡ - å¡«å…… */
    .purity-fill {
      height: 100%;
      width: 0%;                        /* è¿è¡Œæ—¶è®¾ç½® */
      transition: width 0.5s ease;      /* å¹³æ»‘åŠ¨ç”» */
      background: #00e676;              /* è¿è¡Œæ—¶æ ¹æ®åˆ†æ•°æ”¹è‰² */
    }

    /* çŠ¶æ€è‰²ï¼ˆæ–‡æœ¬ç”¨ï¼‰ */
    .purity-green { color: #00e676; font-weight: 600; }
    .purity-yellow { color: #ffeb3b; font-weight: 600; }
    .purity-red   { color: #ff5252; font-weight: 600; }

    /* é¡µè„š */
    footer {
      margin-top: auto;
      text-align: center;
      color: #777;
      font-size: 14px;
      padding: 15px 0;
      user-select: none;
      border-top: 1px solid #222;
    }

    /* å°åŠ¨ç”» */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px);} to { opacity: 1; transform: translateY(0);} }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <!-- ===================== é¡µé¢ç»“æ„ ===================== -->
  <header>What Is My IP</header>

  <!-- å½“å‰ IP å¡ç‰‡ -->
  <div class="card" aria-live="polite" aria-busy="true">
    <h2>ğŸŒ å½“å‰ IP æŸ¥è¯¢</h2>
    <div class="info" id="myIpInfo">æŸ¥è¯¢ä¸­... <span class="loading" id="myIpLoading"></span></div>
    <!-- çº¯å‡€åº¦æ¨¡å—ï¼ˆå½“å‰ IPï¼‰ -->
    <div class="info" id="myIpPurity"></div>
  </div>

  <!-- æ‰‹åŠ¨æŸ¥è¯¢å¡ç‰‡ -->
  <div class="card" aria-live="polite">
    <h2>ğŸ” æ‰‹åŠ¨æŸ¥è¯¢å…¶ä»– IP</h2>
    <div class="input-group">
      <input type="text" id="ipInput" placeholder="è¾“å…¥ IP åœ°å€" aria-label="è¾“å…¥è¦æŸ¥è¯¢çš„ IP åœ°å€" autocomplete="off" />
      <button id="queryBtn" type="button" aria-label="å¼€å§‹æŸ¥è¯¢" onclick="queryIP()">æŸ¥è¯¢</button>
    </div>
    <div class="info" id="result"></div>
    <!-- çº¯å‡€åº¦æ¨¡å—ï¼ˆæ‰‹åŠ¨æŸ¥è¯¢ç»“æœï¼‰ -->
    <div class="info" id="resultPurity"></div>
    <div class="history-list" id="historyList"></div>
  </div>

  <!-- è®¾å¤‡ä¿¡æ¯å¡ç‰‡ -->
  <div class="card">
    <h2>ğŸ–¥ï¸ ç”¨æˆ·è®¾å¤‡ / æµè§ˆå™¨</h2>
    <div class="info" id="deviceInfo">åŠ è½½ä¸­...</div>
  </div>

  <!-- é¡µè„š -->
  <footer>
    è”ç³»æˆ‘: <a href="mailto:yanyu4782@gmail.com" style="color:#00e676; text-decoration:none;">yanyu4782@gmail.com</a>
  </footer>

  <!-- ===================== è„šæœ¬ï¼ˆè¯¦ç»†æ³¨é‡Š + æ¨¡å—åŒ–ï¼‰ ===================== -->
  <script>
    // =============================================================
    // é…ç½®åŒºï¼šåœ¨è¿™é‡Œå¡«å†™ä½ çš„ AbuseIPDB API Key
    // è­¦å‘Šï¼šKey æ”¾åœ¨å‰ç«¯ä¼šæš´éœ²ç»™æ‰€æœ‰äººï¼Œä»…é™è‡ªç”¨/æµ‹è¯•ã€‚
    // =============================================================
    const ABUSE_API_KEY = "7ff20287c065632f6351c61f84877fe819494b5c1342ee28bf26edf623d4bdf21ecaef989e58b416";

    // =============================================================
    // å·¥å…·å‡½æ•°ï¼šIP ç‰ˆæœ¬åˆ¤æ–­ï¼ˆç»´æŒä¸åŸé€»è¾‘ä¸€è‡´ï¼ŒIPv6 ä½¿ç”¨å…¨å†™åŒ¹é…ï¼‰
    // =============================================================
    function getIPVersion(ip) {
      const ipv4Pattern = /^(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)){3}$/;
      // IPv6 è¿™é‡Œæ²¿ç”¨åŸå§‹çš„â€œå…¨ 8 ç»„â€åŒ¹é…ï¼Œä¿è¯ä¸åŸé€»è¾‘ä¸€è‡´æ€§ä¸ç¨³å®šæ€§
      const ipv6Pattern = /^(([0-9a-fA-F]{1,4}):){7}([0-9a-fA-F]{1,4})$/;
      if (ipv4Pattern.test(ip)) return "IPv4";
      if (ipv6Pattern.test(ip)) return "IPv6";
      return "æœªçŸ¥ç±»å‹";
    }

    // =============================================================
    // è®¾å¤‡æŒ‡çº¹ï¼ˆä»…åŸºäº UA ç®€å•åˆ¤æ–­ï¼Œè¶³å¤Ÿç¨³å®šï¼‰
    // =============================================================
    function detectDevice() {
      const ua = navigator.userAgent;
      const el = document.getElementById("deviceInfo");

      let system = "æœªçŸ¥ç³»ç»Ÿ";
      let browser = "æœªçŸ¥æµè§ˆå™¨";
      let iconSystem = "";
      let iconBrowser = "";

      // ç³»ç»Ÿåˆ¤æ–­
      if (/Android/i.test(ua)) { system = "Android"; iconSystem = '<i class="fab fa-android"></i>'; }
      else if (/iPhone|iPad/i.test(ua)) { system = "iOS"; iconSystem = '<i class="fab fa-apple"></i>'; }
      else if (/Windows/i.test(ua)) { system = "Windows"; iconSystem = '<i class="fab fa-windows"></i>'; }
      else if (/Macintosh/i.test(ua)) { system = "macOS"; iconSystem = '<i class="fab fa-apple"></i>'; }

      // æµè§ˆå™¨åˆ¤æ–­
      if (/Chrome\//i.test(ua)) { browser = "Chrome"; iconBrowser = '<i class="fab fa-chrome"></i>'; }
      else if (/Firefox\//i.test(ua)) { browser = "Firefox"; iconBrowser = '<i class="fab fa-firefox-browser"></i>'; }
      else if (/Safari\//i.test(ua) && !/Chrome\//i.test(ua)) { browser = "Safari"; iconBrowser = '<i class="fab fa-safari"></i>'; }
      else if (/Edg\//i.test(ua)) { browser = "Edge"; iconBrowser = '<i class="fab fa-edge"></i>'; }

      el.innerHTML = `ğŸ’» ç³»ç»Ÿï¼š${iconSystem} ${system}<br>ğŸŒ æµè§ˆå™¨ï¼š${iconBrowser} ${browser}`;
    }

    // =============================================================
    // çº¯å‡€åº¦æ¡ï¼šæ¸²æŸ“ä¸ºè¿›åº¦æ¡ + æ–‡æœ¬ï¼ˆç¨³å®šç®€å•ï¼‰
    // purityPercent: 0-100 çš„æ•°å€¼ï¼›container: DOM å®¹å™¨
    // =============================================================
    function renderPurityBar(purityPercent, container) {
      // å…ˆæ¸…ç©ºå®¹å™¨
      container.innerHTML = "";

      // åˆ›å»ºæ–‡å­—æè¿°
      const label = document.createElement('div');
      const purityText = `ğŸ›¡ï¸ çº¯å‡€åº¦ï¼š${purityPercent}%`;
      // æ ¹æ®é˜ˆå€¼è®¾ç½®æ–‡å­—é¢œè‰²ï¼ˆç»¿è‰²>=70ï¼Œé»„è‰²20-69ï¼Œçº¢è‰²<20ï¼‰
      if (purityPercent >= 70) {
        label.className = 'purity-green';
      } else if (purityPercent >= 20) {
        label.className = 'purity-yellow';
      } else {
        label.className = 'purity-red';
      }
      label.textContent = purityText;
      container.appendChild(label);

      // è¿›åº¦æ¡å®¹å™¨
      const bar = document.createElement('div');
      bar.className = 'purity-bar';
      bar.setAttribute('role', 'progressbar');
      bar.setAttribute('aria-valuemin', '0');
      bar.setAttribute('aria-valuemax', '100');
      bar.setAttribute('aria-valuenow', String(purityPercent));

      // è¿›åº¦æ¡å¡«å……
      const fill = document.createElement('div');
      fill.className = 'purity-fill';
      fill.style.width = purityPercent + '%';

      // æ ¹æ®é˜ˆå€¼è°ƒè‰²ï¼ˆä¸æ–‡å­—ä¸€è‡´ï¼‰
      if (purityPercent >= 70) fill.style.background = '#00e676';
      else if (purityPercent >= 20) fill.style.background = '#ffeb3b';
      else fill.style.background = '#ff5252';

      bar.appendChild(fill);
      container.appendChild(bar);
    }

    // =============================================================
    // AbuseIPDB æŸ¥è¯¢ï¼šè¿”å› { purityPercent, usageText, isHosting, rawScore }
    // æ³¨ï¼šabuseConfidenceScore è¶Šé«˜è¶Šâ€œè„â€ï¼Œæˆ‘ä»¬ç”¨ 100-score ä½œä¸ºçº¯å‡€åº¦
    // =============================================================
    async function fetchAbuseInfo(ip) {
      const endpoint = `https://api.abuseipdb.com/api/v2/check?ipAddress=${encodeURIComponent(ip)}&maxAgeInDays=90`;
      const headers = { 'Key': ABUSE_API_KEY, 'Accept': 'application/json' };

      try {
        const res = await fetch(endpoint, { headers });
        if (!res.ok) {
          // é 2xxï¼Œè¿”å›å…œåº•ç»“æœï¼Œä¿æŒç¨³å®š
          return { ok: false, message: 'æ¥å£å“åº”å¼‚å¸¸', purityPercent: null, usageText: null, isHosting: null, rawScore: null };
        }
        const json = await res.json();
        if (!json || !json.data) {
          return { ok: false, message: 'æ•°æ®ä¸ºç©º', purityPercent: null, usageText: null, isHosting: null, rawScore: null };
        }

        const score = Number(json.data.abuseConfidenceScore || 0); // 0-100ï¼ˆé«˜=åï¼‰
        const usage = json.data.usageType || 'æœªçŸ¥';                // ä¾‹å¦‚ï¼šData Center/Web Hosting/Transit
        const purity = Math.max(0, Math.min(100, 100 - score));     // è½¬æˆçº¯å‡€åº¦

        // æœºæˆ¿/æ•°æ®ä¸­å¿ƒåˆ¤å®šå…³é”®å­—ï¼ˆæ›´ç¨³å¦¥äº›ï¼Œå¤§å°å†™ä¸æ•æ„Ÿï¼‰
        const hostingKeywords = ['hosting', 'data center', 'datacenter', 'transit', 'cloud'];
        const usageLower = usage.toLowerCase();
        const isHosting = hostingKeywords.some(k => usageLower.includes(k));

        return {
          ok: true,
          message: 'ok',
          purityPercent: purity,
          usageText: usage,
          isHosting,
          rawScore: score
        };
      } catch (err) {
        // ç½‘ç»œé”™è¯¯ç­‰æƒ…å†µï¼Œç¨³å®šè¿”å›å…œåº•
        return { ok: false, message: 'ç½‘ç»œé”™è¯¯', purityPercent: null, usageText: null, isHosting: null, rawScore: null };
      }
    }

    // =============================================================
    // æ¸²æŸ“çº¯å‡€åº¦ä¿¡æ¯ï¼šæ–‡æœ¬ + è¿›åº¦æ¡ + ç”¨é€”/ç±»å‹åˆ¤æ–­
    // =============================================================
    function renderPurityInfo(result, container) {
      // å…ˆæ¸…ç©º
      container.innerHTML = '';

      if (!result || !result.ok || result.purityPercent === null) {
        container.innerHTML = "<span style='color:#ff5555;'>âš ï¸ æ— æ³•æ£€æµ‹çº¯å‡€åº¦</span>";
        return;
      }

      // 1) çº¯å‡€åº¦æ¡
      renderPurityBar(result.purityPercent, container);

      // 2) ç±»å‹ä¸ç”¨é€”
      const typeLine = document.createElement('div');
      typeLine.style.marginTop = '8px';
      typeLine.innerHTML = `ğŸ¢ ç±»å‹ï¼š${ result.isHosting ? 'æœºæˆ¿ / æ•°æ®ä¸­å¿ƒ' : 'å®¶åº­åŸç”ŸIP' }`;
      container.appendChild(typeLine);

      const usageLine = document.createElement('div');
      usageLine.style.opacity = '0.85';
      usageLine.textContent = `ğŸ“‹ ç”¨é€”æ ‡è®°ï¼š${result.usageText}`;
      container.appendChild(usageLine);
    }

    // =============================================================
    // æŸ¥è¯¢â€œå½“å‰ IPâ€å¹¶æ¸²æŸ“
    // =============================================================
    async function loadMyIP() {
      const el = document.getElementById('myIpInfo');
      const loadingEl = document.getElementById('myIpLoading');
      const purityBox = document.getElementById('myIpPurity');

      // æ¯æ¬¡åŠ è½½å‰æ¸…ç©ºçº¯å‡€åº¦åŒºåŸŸ
      purityBox.innerHTML = '';

      try {
        // 1) å–æœ¬æœº IP
        const resIp = await fetch('https://api.ipify.org?format=json');
        const { ip } = await resIp.json();

        // 2) å–åœ°ç†/ISP ä¿¡æ¯
        const ipVersion = getIPVersion(ip);
        const res = await fetch(`https://ipapi.co/${ip}/json`);
        const data = await res.json();
        if (data.error) throw new Error(data.reason || 'æŸ¥è¯¢å¤±è´¥');

        // 3) å›½æ——å›¾æ ‡
        const flagUrl = data.country_code ? `https://flagcdn.com/w40/${String(data.country_code).toLowerCase()}.png` : '';
        const flagImg = flagUrl ? `<img src="${flagUrl}" alt="å›½æ——" class="flag" />` : '';

        // 4) æ¸²æŸ“åŸºæœ¬ä¿¡æ¯
        el.innerHTML = [
          `ğŸ“Œ IPï¼š${data.ip} (${ipVersion}) ${flagImg}`,
          `ğŸŒ ä½ç½®ï¼š${data.city || '-'}, ${data.region || '-'}, ${data.country_name || '-'}`,
          `ğŸ“¡ ISPï¼š${data.org || 'æœªçŸ¥'}`,
          `ğŸ§­ ç»çº¬åº¦ï¼š${data.latitude || '-'}, ${data.longitude || '-'}`,
          `â° æ—¶åŒºï¼š${data.timezone || '-'}`
        ].join('<br>');

        // 5) æ¸²æŸ“çº¯å‡€åº¦ï¼ˆåˆ†æ­¥æ¸²æŸ“ï¼Œä¿éšœç¨³å®šï¼‰
        purityBox.textContent = 'æ£€æµ‹çº¯å‡€åº¦ä¸­...';
        const abuse = await fetchAbuseInfo(ip);
        renderPurityInfo(abuse, purityBox);

      } catch (e) {
        // å¤±è´¥å…œåº•
        el.innerText = 'âŒ æŸ¥è¯¢å¤±è´¥ï¼Œè¯·ç¨åå†è¯•';
        purityBox.innerHTML = '';
      } finally {
        // å»é™¤ loading
        if (loadingEl) loadingEl.style.display = 'none';
      }
    }

    // =============================================================
    // æ‰‹åŠ¨æŸ¥è¯¢ä»»æ„ IP å¹¶æ¸²æŸ“
    // =============================================================
    async function queryIP() {
      const ipInput = document.getElementById('ipInput');
      const ip = (ipInput.value || '').trim();
      if (!ip) { alert('è¯·è¾“å…¥ IP åœ°å€ï¼'); return; }

      const resEl = document.getElementById('result');
      const purityBox = document.getElementById('resultPurity');

      // é¢„å…ˆæ¸…ç† UI
      resEl.innerHTML = 'æŸ¥è¯¢ä¸­... <span class="loading"></span>';
      purityBox.innerHTML = '';

      try {
        const res = await fetch(`https://ipapi.co/${encodeURIComponent(ip)}/json`);
        const data = await res.json();
        if (data.error) throw new Error(data.reason || 'æŸ¥è¯¢å¤±è´¥');

        const ipVersion = getIPVersion(ip);
        const flagUrl = data.country_code ? `https://flagcdn.com/w40/${String(data.country_code).toLowerCase()}.png` : '';
        const flagImg = flagUrl ? `<img src="${flagUrl}" alt="å›½æ——" class="flag" />` : '';

        resEl.innerHTML = [
          `ğŸ“Œ IPï¼š${data.ip} (${ipVersion}) ${flagImg}`,
          `ğŸŒ ä½ç½®ï¼š${data.city || '-'}, ${data.region || '-'}, ${data.country_name || '-'}`,
          `ğŸ“¡ ISPï¼š${data.org || 'æœªçŸ¥'}`,
          `ğŸ§­ ç»çº¬åº¦ï¼š${data.latitude || '-'}, ${data.longitude || '-'}`,
          `â° æ—¶åŒºï¼š${data.timezone || '-'}`
        ].join('<br>');

        // æ¸²æŸ“çº¯å‡€åº¦
        purityBox.textContent = 'æ£€æµ‹çº¯å‡€åº¦ä¸­...';
        const abuse = await fetchAbuseInfo(ip);
        renderPurityInfo(abuse, purityBox);

        // ä¿å­˜å†å²
        saveHistory(ip);

      } catch (e) {
        resEl.innerHTML = `<span style="color:#ff5555;">âŒ æŸ¥è¯¢å¤±è´¥ï¼š${e.message}</span>`;
        purityBox.innerHTML = '';
      }
    }

    // =============================================================
    // æŸ¥è¯¢å†å²ï¼šæœ¬åœ°æŒä¹…åŒ–ï¼ˆlocalStorageï¼‰
    // =============================================================
    function getHistory() {
      try {
        return JSON.parse(localStorage.getItem('ipQueryHistory')) || [];
      } catch {
        return [];
      }
    }

    function saveHistory(ip) {
      let history = getHistory();
      // å»é‡ + å¤´éƒ¨æ’å…¥
      history = history.filter(item => item !== ip);
      history.unshift(ip);
      // æœ€å¤šä¿ç•™ 8 æ¡ï¼ˆæ›´å®ç”¨ï¼‰
      if (history.length > 8) history = history.slice(0, 8);
      localStorage.setItem('ipQueryHistory', JSON.stringify(history));
      renderHistory();
    }

    function renderHistory() {
      const history = getHistory();
      const container = document.getElementById('historyList');

      if (!container) return;

      if (history.length === 0) {
        container.innerHTML = '<em>æš‚æ— æŸ¥è¯¢å†å²</em>';
        return;
      }

      // ç”Ÿæˆå¯ç‚¹å‡»çš„å†å²é¡¹
      container.innerHTML = 'æŸ¥è¯¢å†å²: ';
      history.forEach(ip => {
        const span = document.createElement('span');
        span.textContent = ip;
        span.title = 'ç‚¹å‡»é‡æ–°æŸ¥è¯¢ ' + ip;
        span.onclick = () => {
          document.getElementById('ipInput').value = ip;
          queryIP();
        };
        container.appendChild(span);
      });

      // åŠ ä¸€ä¸ªæ¸…ç©ºæŒ‰é’®ä»¥ä¿è¯å¯æ§æ€§ï¼ˆå¯é€‰ï¼‰
      const clearBtn = document.createElement('button');
      clearBtn.textContent = 'æ¸…ç©ºå†å²';
      clearBtn.style.marginLeft = '10px';
      clearBtn.onclick = () => {
        localStorage.removeItem('ipQueryHistory');
        renderHistory();
      };
      container.appendChild(clearBtn);
    }

    // =============================================================
    // åˆå§‹åŒ–å…¥å£ï¼šæŒ‰é¡ºåºæ‰§è¡Œï¼Œç¡®ä¿é¡µé¢ç¨³å®š
    // =============================================================
    window.onload = () => {
      try {
        detectDevice();     // 1) æ¸²æŸ“è®¾å¤‡ä¿¡æ¯
        renderHistory();    // 2) æ¸²æŸ“å†å²ï¼ˆå³ä½¿ä¸ºç©ºä¹Ÿç¨³å®šï¼‰
        loadMyIP();         // 3) æŸ¥è¯¢å½“å‰ IPï¼ˆå¼‚æ­¥ï¼‰
      } catch (e) {
        // æ•´ä½“å…œåº•ï¼ˆåŸºæœ¬ä¸ä¼šè§¦å‘ï¼‰
        console.error('åˆå§‹åŒ–å¤±è´¥', e);
      }
    };
  </script>
</body>
</html>
