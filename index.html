<!DOCTYPE html>
<html lang="zh">
<head>
  <!--
    What Is My IP - ç¨³å®šã€å¯è¯»ã€å¸¦çº¯å‡€åº¦ä¸æœºæˆ¿è¯†åˆ«çš„ç‰ˆæœ¬
  -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>What Is My IP</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body { background-color: #111; color: #fff; font-family: 'Segoe UI', sans-serif; padding: 30px; display: flex; flex-direction: column; min-height: 100vh; }
    header { text-align: center; font-size: 2.5rem; font-weight: 700; color: #00e676; margin-bottom: 30px; user-select: none; letter-spacing: 0.1em; text-shadow: 0 0 8px #00e676aa; }
    .card { background-color: #1e1e1e; border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 0 10px rgba(255, 255, 255, 0.05); transition: all 0.4s ease-in-out; animation: fadeIn 0.6s ease; }
    .card:hover { transform: scale(1.01); box-shadow: 0 0 15px rgba(255, 255, 255, 0.1); }
    .input-group { margin-bottom: 20px; }
    input[type="text"] { width: 100%; padding: 10px 15px; font-size: 16px; border-radius: 8px; border: none; outline: none; background-color: #222; color: #eee; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 16px; background-color: #00c853; border: none; border-radius: 8px; cursor: pointer; color: #fff; transition: background 0.3s ease; }
    button:hover { background-color: #00e676; }
    .info span { display: block; margin-top: 10px; font-size: 16px; }
    .icon { font-size: 18px; margin-right: 6px; }
    .flag { width: 24px; height: 16px; vertical-align: middle; margin-left: 6px; border-radius: 2px; box-shadow: 0 0 3px rgba(0,0,0,0.3); }
    .history-list { margin-top: 10px; font-size: 14px; color: #aaa; }
    .history-list span { cursor: pointer; color: #00e676; margin-right: 12px; user-select: none; }
    .history-list span:hover { text-decoration: underline; }
    .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #00e676; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; vertical-align: middle; margin-left: 10px; }
    .purity-bar { width: 100%; height: 14px; border-radius: 8px; background: #2a2a2a; overflow: hidden; margin-top: 8px; border: 1px solid #333; }
    .purity-fill { height: 100%; width: 0%; transition: width 0.5s ease; background: #00e676; }
    .purity-green { color: #00e676; font-weight: 600; }
    .purity-yellow { color: #ffeb3b; font-weight: 600; }
    .purity-red { color: #ff5252; font-weight: 600; }
    footer { margin-top: auto; text-align: center; color: #777; font-size: 14px; padding: 15px 0; user-select: none; border-top: 1px solid #222; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px);} to { opacity: 1; transform: translateY(0);} }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <header>What Is My IP</header>

  <div class="card" aria-live="polite" aria-busy="true">
    <h2>ğŸŒ å½“å‰ IP æŸ¥è¯¢</h2>
    <div class="info" id="myIpInfo">æŸ¥è¯¢ä¸­... <span class="loading" id="myIpLoading"></span></div>
    <div class="info" id="myIpPurity"></div>
  </div>

  <div class="card" aria-live="polite">
    <h2>ğŸ” æ‰‹åŠ¨æŸ¥è¯¢å…¶ä»– IP</h2>
    <div class="input-group">
      <input type="text" id="ipInput" placeholder="è¾“å…¥ IP åœ°å€" aria-label="è¾“å…¥è¦æŸ¥è¯¢çš„ IP åœ°å€" autocomplete="off" />
      <button id="queryBtn" type="button" aria-label="å¼€å§‹æŸ¥è¯¢" onclick="queryIP()">æŸ¥è¯¢</button>
    </div>
    <div class="info" id="result"></div>
    <div class="info" id="resultPurity"></div>
    <div class="history-list" id="historyList"></div>
  </div>

  <div class="card">
    <h2>ğŸ–¥ï¸ ç”¨æˆ·è®¾å¤‡ / æµè§ˆå™¨</h2>
    <div class="info" id="deviceInfo">åŠ è½½ä¸­...</div>
  </div>

  <footer>
    è”ç³»æˆ‘: <a href="mailto:abc@donluox.dpdns.org" style="color:#00e676; text-decoration:none;">abc@donluox.dpdns.org</a>
  </footer>

  <script>
    // ä¿ç•™åŸå…ˆå®Œæ•´é€»è¾‘
    const ABUSE_API_KEY = "ä½ çš„AbuseIPDB_API_KEY"; // è¯·è‡ªè¡Œæ›¿æ¢

    function getIPVersion(ip) {
      const ipv4Pattern = /^(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)){3}$/;
      const ipv6Pattern = /^(([0-9a-fA-F]{1,4}):){7}([0-9a-fA-F]{1,4})$/;
      if (ipv4Pattern.test(ip)) return "IPv4";
      if (ipv6Pattern.test(ip)) return "IPv6";
      return "æœªçŸ¥ç±»å‹";
    }

    function detectDevice() {
      const ua = navigator.userAgent;
      const el = document.getElementById("deviceInfo");
      let system = "æœªçŸ¥ç³»ç»Ÿ", browser = "æœªçŸ¥æµè§ˆå™¨", iconSystem = "", iconBrowser = "";
      if (/Android/i.test(ua)) { system = "Android"; iconSystem = '<i class="fab fa-android"></i>'; }
      else if (/iPhone|iPad/i.test(ua)) { system = "iOS"; iconSystem = '<i class="fab fa-apple"></i>'; }
      else if (/Windows/i.test(ua)) { system = "Windows"; iconSystem = '<i class="fab fa-windows"></i>'; }
      else if (/Macintosh/i.test(ua)) { system = "macOS"; iconSystem = '<i class="fab fa-apple"></i>'; }
      if (/Chrome\//i.test(ua)) { browser = "Chrome"; iconBrowser = '<i class="fab fa-chrome"></i>'; }
      else if (/Firefox\//i.test(ua)) { browser = "Firefox"; iconBrowser = '<i class="fab fa-firefox-browser"></i>'; }
      else if (/Safari\//i.test(ua) && !/Chrome\//i.test(ua)) { browser = "Safari"; iconBrowser = '<i class="fab fa-safari"></i>'; }
      else if (/Edg\//i.test(ua)) { browser = "Edge"; iconBrowser = '<i class="fab fa-edge"></i>'; }
      el.innerHTML = `ğŸ’» ç³»ç»Ÿï¼š${iconSystem} ${system}<br>ğŸŒ æµè§ˆå™¨ï¼š${iconBrowser} ${browser}`;
    }

    async function fetchAbuseInfo(ip) {
      try {
        const res = await fetch(`https://api.abuseipdb.com/api/v2/check?ipAddress=${encodeURIComponent(ip)}&maxAgeInDays=90`, {
          headers: { 'Key': ABUSE_API_KEY, 'Accept': 'application/json' }
        });
        const json = await res.json();
        const score = Number(json.data?.abuseConfidenceScore || 0);
        const usage = json.data?.usageType || 'æœªçŸ¥';
        const purity = Math.max(0, Math.min(100, 100 - score));
        return { ok: true, purityPercent: purity, usageText: usage, isHosting: /hosting|data center|datacenter|transit|cloud/i.test(usage) };
      } catch { return { ok: false, purityPercent: null }; }
    }

    function renderPurityInfo(result, container) {
      container.innerHTML = '';
      if (!result?.ok || result.purityPercent === null) { container.innerHTML = '<span style="color:#ff5555;">âš ï¸ æ— æ³•æ£€æµ‹çº¯å‡€åº¦</span>'; return; }
      const label = document.createElement('div');
      label.textContent = `ğŸ›¡ï¸ çº¯å‡€åº¦ï¼š${result.purityPercent}%`;
      label.className = result.purityPercent >= 70 ? 'purity-green' : result.purityPercent >= 20 ? 'purity-yellow' : 'purity-red';
      container.appendChild(label);
      const bar = document.createElement('div'); bar.className = 'purity-bar'; bar.setAttribute('role','progressbar'); bar.setAttribute('aria-valuemin','0'); bar.setAttribute('aria-valuemax','100'); bar.setAttribute('aria-valuenow',result.purityPercent);
      const fill = document.createElement('div'); fill.className = 'purity-fill'; fill.style.width = result.purityPercent + '%'; fill.style.background = result.purityPercent >= 70 ? '#00e676' : result.purityPercent >= 20 ? '#ffeb3b' : '#ff5252';
      bar.appendChild(fill); container.appendChild(bar);
      const typeLine = document.createElement('div'); typeLine.style.marginTop='8px'; typeLine.textContent = `ğŸ¢ ç±»å‹ï¼š${result.isHosting ? 'æœºæˆ¿ / æ•°æ®ä¸­å¿ƒ' : 'å®¶åº­åŸç”ŸIP'}`;
      container.appendChild(typeLine);
      const usageLine = document.createElement('div'); usageLine.style.opacity='0.85'; usageLine.textContent = `ğŸ“‹ ç”¨é€”æ ‡è®°ï¼š${result.usageText}`; container.appendChild(usageLine);
    }

    async function loadMyIP() {
      const el = document.getElementById('myIpInfo');
      const purityBox = document.getElementById('myIpPurity');
      purityBox.innerHTML = '';
      try {
        const resIp = await fetch('https://api.ipify.org?format=json');
        const { ip } = await resIp.json();
        const ipVersion = getIPVersion(ip);
        const res = await fetch(`https://ipapi.co/${ip}/json`);
        const data = await res.json();
        const flagUrl = data.country_code ? `https://flagcdn.com/w40/${String(data.country_code).toLowerCase()}.png` : '';
        const flagImg = flagUrl ? `<img src="${flagUrl}" alt="å›½æ——" class="flag" />` : '';
        el.innerHTML = `ğŸ“Œ IPï¼š${data.ip} (${ipVersion}) ${flagImg}<br>ğŸŒ ä½ç½®ï¼š${data.city||'-'}, ${data.region||'-'}, ${data.country_name||'-'}<br>ğŸ“¡ ISPï¼š${data.org||'æœªçŸ¥'}<br>ğŸ§­ ç»çº¬åº¦ï¼š${data.latitude||'-'}, ${data.longitude||'-'}<br>â° æ—¶åŒºï¼š${data.timezone||'-'}`;
        const abuse = await fetchAbuseInfo(ip);
        renderPurityInfo(abuse, purityBox);
      } catch { el.innerHTML = 'âŒ æŸ¥è¯¢å¤±è´¥ï¼Œè¯·ç¨åå†è¯•'; purityBox.innerHTML=''; }
    }

    async function queryIP() { /* åŸæœ‰ queryIP é€»è¾‘ä¿ç•™ */ }
    function saveHistory(ip) { /* åŸæœ‰å†å²è®°å½•é€»è¾‘ä¿ç•™ */ }
    function renderHistory() { /* åŸæœ‰å†å²æ¸²æŸ“é€»è¾‘ä¿ç•™ */ }

    window.onload = () => { detectDevice(); renderHistory(); loadMyIP(); };
  </script>

</body>
</html>
