<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>What Is My IP - Pro</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<!-- åœ°å›¾æ ·å¼ -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
/* --- æ ¸å¿ƒæ ·å¼ --- */
body {
  background: #0d1117;
  color: #fff;
  font-family: 'Segoe UI', sans-serif;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  padding: 20px;
  margin: 0;
}
header {
  text-align: center;
  font-size: 2rem;
  color: #00e676;
  font-weight: 700;
  margin-bottom: 25px;
  text-shadow: 0 0 8px #00e676aa;
}
.card {
  background-color: #1e1e1e;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 0 12px rgba(0,0,0,0.5);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  max-width: 800px;
  margin-left: auto; margin-right: auto;
  width: 100%;
  box-sizing: border-box;
}
.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 15px rgba(0,230,118,0.2);
}
.card h2 {
  margin-top: 0;
  margin-bottom: 15px;
  color: #00e676;
  font-size: 1.3rem;
  display: flex;
  align-items: center;
  border-bottom: 1px solid #333;
  padding-bottom: 10px;
}
.card h2 span { margin-right: 8px; }

/* è¾“å…¥æ¡†ç»„ */
.input-group { margin-bottom: 15px; display: flex; gap: 10px; }
input {
  flex: 1;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #333;
  background-color: #222;
  color: #eee;
  font-size: 15px;
  outline: none;
}
input:focus { border-color: #00e676; }
button.search-btn {
  padding: 10px 18px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background-color: #00c853;
  color: #fff;
  font-size: 15px;
  transition: background 0.3s ease;
  white-space: nowrap;
}
button.search-btn:hover { background-color: #00e676; }

/* ä¿¡æ¯å±•ç¤º */
.info { font-size: 15px; line-height: 1.8; }
.flag { width: 24px; height: auto; vertical-align: middle; margin-left: 6px; border-radius: 2px; }

/* --- çº¯å‡€åº¦æ ‡ç­¾æ ·å¼ --- */
.badge {
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
    margin-left: 5px;
    vertical-align: middle;
}
.badge-green { color: #00e676; background: rgba(0,230,118,0.1); border: 1px solid rgba(0,230,118,0.3); }
.badge-red { color: #ff5252; background: rgba(255,82,82,0.1); border: 1px solid rgba(255,82,82,0.3); }
.badge-yellow { color: #ffab00; background: rgba(255,171,0,0.1); border: 1px solid rgba(255,171,0,0.3); }

/* --- å¤–éƒ¨å·¥å…·æŒ‰é’®ç»„ --- */
.tool-links {
  margin-top: 15px;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}
.tool-btn {
  flex: 1;
  text-align: center;
  padding: 8px 12px;
  background: #2a2a2a;
  border: 1px solid #444;
  border-radius: 6px;
  color: #ccc;
  text-decoration: none;
  font-size: 13px;
  transition: 0.2s;
}
.tool-btn:hover {
  background: #333;
  color: #fff;
  border-color: #00e676;
}
.tool-btn i { margin-right: 5px; }

/* å†å²è®°å½• */
.history-list { margin-top: 15px; font-size: 13px; color: #aaa; }
.history-tag {
  cursor: pointer;
  margin-right: 8px;
  padding: 3px 8px;
  border-radius: 4px;
  background: #2a2a2a;
  border: 1px solid #333;
  display: inline-block;
  margin-bottom: 5px;
  transition: 0.2s;
}
.history-tag:hover { border-color: #00e676; color: #00e676; }

/* åœ°å›¾ä¸åŠ è½½ */
#map { width: 100%; height: 250px; margin-top: 15px; border-radius: 8px; display: none; }
.loading {
  display: inline-block;
  width: 18px; height: 18px;
  border: 3px solid #00e676;
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 1s linear infinite;
  vertical-align: middle;
  margin-left: 8px;
}
.device-icon { margin-right:6px; width: 20px; text-align: center; }
footer { text-align: center; margin-top: auto; color: #777; font-size: 13px; padding: 12px 0; }
@keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<header>ğŸŒ What Is My IP</header>

<!-- 1. å½“å‰ IP å¡ç‰‡ -->
<div class="card">
  <h2><span>ğŸ“</span> å½“å‰ç½‘ç»œç¯å¢ƒ</h2>
  <div class="info" id="myIpInfo">æŸ¥è¯¢ä¸­... <span class="loading"></span></div>
</div>

<!-- 2. æ‰‹åŠ¨æŸ¥è¯¢å¡ç‰‡ -->
<div class="card">
  <h2><span>ğŸ”</span> æ‰‹åŠ¨æŸ¥è¯¢å…¶ä»– IP</h2>
  <div class="input-group">
    <input type="text" id="ipInput" placeholder="è¾“å…¥ IP åœ°å€">
    <button class="search-btn" onclick="queryIP()">æŸ¥è¯¢</button>
  </div>
  
  <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
  <div class="info" id="result"></div>
  
  <!-- åœ°å›¾ -->
  <div id="map"></div>
  
  <!-- å†å²è®°å½• -->
  <div class="history-list" id="historyList"></div>
</div>

<!-- 3. è®¾å¤‡ä¿¡æ¯å¡ç‰‡ -->
<div class="card">
  <h2><span>ğŸ–¥ï¸</span> ç”¨æˆ·è®¾å¤‡ / æµè§ˆå™¨</h2>
  <div class="info" id="deviceInfo">åŠ è½½ä¸­...</div>
</div>

<footer>
  è”ç³»æˆ‘: <a href="mailto:donluox@protonmail.com" style="color:#00e676; text-decoration:none;">donluox@protonmail.com</a>
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>

// --- åŠŸèƒ½ 1: IP ç±»å‹åˆ†æå‡½æ•° ---
function analyzeIpType(isp, org, asn) {
  const text = (isp + " " + org + " " + asn).toLowerCase();
  
  // æœºæˆ¿å…³é”®è¯
  const dcKeywords = [
    'cloud', 'hosting', 'vps', 'server', 'data center', 'datacenter',
    'amazon', 'aws', 'google', 'microsoft', 'azure', 'digitalocean', 'linode', 'vultr',
    'alibaba', 'tencent', 'huawei', 'ucloud', 'choopa', 'hetzner', 'ovh', 
    'leaseweb', 'zenlayer', 'host', 'm247', 'xtom', 'misaka', 'oracle'
  ];

  // ä½å®…å…³é”®è¯
  const resKeywords = [
    'telecom', 'cable', 'dsl', 'fiber', 'broadband', 'internet', 'mobile', 
    'comcast', 'verizon', 'at&t', 'spectrum', 'virgin', 'vodafone', 't-mobile', 
    'china telecom', 'china unicom', 'china mobile', 'hkt', 'pccw', 'kt corporation'
  ];

  let type = "æœªçŸ¥ç±»å‹";
  let badgeClass = "badge-yellow"; 
  let desc = "æ— æ³•ç¡®å®šç±»å‹";

  const isDC = dcKeywords.some(kw => text.includes(kw));
  const isRes = resKeywords.some(kw => text.includes(kw));

  if (isDC) {
    type = "ğŸ¢ æœºæˆ¿/æ•°æ®ä¸­å¿ƒ";
    badgeClass = "badge-red";
    desc = "ç–‘ä¼¼ä»£ç†æˆ– VPNï¼Œé£æ§å€¼å¯èƒ½è¾ƒé«˜";
  } else if (isRes) {
    type = "ğŸ  ä½å®… ISP";
    badgeClass = "badge-green";
    desc = "åŸç”Ÿ IPï¼Œé€šå¸¸è¾ƒä¸ºçº¯å‡€";
  } else {
    type = "ğŸ¢ ä¼ä¸š/ç»„ç»‡";
    desc = "å¯èƒ½æ˜¯ä¼ä¸šä¸“çº¿";
  }

  return { type, badgeClass, desc };
}

// --- åŠŸèƒ½ 2: è·å– IP ä¿¡æ¯ä¸æ¸²æŸ“ ---
async function fetchIPInfo(ip, el, isManual = false){
  el.innerHTML = 'æŸ¥è¯¢ä¸­... <span class="loading"></span>';
  if(isManual) document.getElementById('map').style.display = 'none';

  try {
    const url = ip ? `https://ipapi.co/${ip}/json/` : 'https://ipapi.co/json/';
    const res = await fetch(url);
    if (!res.ok) throw new Error("API è¯·æ±‚è¿‡å¿«ï¼Œè¯·ç¨å");
    const data = await res.json();

    if(data.error) throw new Error(data.reason || "IP æ— æ•ˆ");

    // æ ¸å¿ƒåˆ†æ
    const analysis = analyzeIpType(data.org || '', data.isp || '', data.asn || '');
    const countryFlag = data.country_code ? `<img class="flag" src="https://flagcdn.com/24x18/${data.country_code.toLowerCase()}.png">` : '';

    // æ¸²æŸ“ä¸»ä¿¡æ¯
    let htmlContent = `
      <div><strong>IP åœ°å€:</strong> ${data.ip}</div>
      <div><strong>å½’å±åœ°:</strong> ${data.country_name||'æœªçŸ¥'} ${countryFlag} - ${data.city||''}</div>
      <div><strong>è¿è¥å•†:</strong> ${data.org || data.isp}</div>
      <div><strong>çº¯å‡€åº¦:</strong> <span class="badge ${analysis.badgeClass}">${analysis.type}</span> <span style="color:#888; font-size:13px;">(${analysis.desc})</span></div>
      <div><strong>æ—¶åŒº:</strong> ${data.timezone}</div>
    `;

    // å¦‚æœæ˜¯æ‰‹åŠ¨æŸ¥è¯¢ï¼Œæ·»åŠ å¤–éƒ¨å·¥å…·æŒ‰é’®
    if (isManual) {
      htmlContent += `
        <div class="tool-links">
          <a href="https://scamalytics.com/ip/${data.ip}" target="_blank" class="tool-btn" title="æŸ¥çœ‹æ¬ºè¯ˆåˆ†æ•°"><i class="fa-solid fa-shield-halved"></i> Scamalytics</a>
          <a href="https://whoer.net/check?host=${data.ip}" target="_blank" class="tool-btn" title="æ£€æŸ¥ä¼ªè£…åº¦"><i class="fa-solid fa-user-secret"></i> Whoer</a>
          <a href="https://bgp.he.net/ip/${data.ip}" target="_blank" class="tool-btn" title="BGP è·¯ç”±ä¿¡æ¯"><i class="fa-solid fa-network-wired"></i> BGP.he.net</a>
        </div>
      `;
      
      if (data.latitude && data.longitude) updateMap(data.latitude, data.longitude, data.city);
      addHistory(data.ip);
    }

    el.innerHTML = htmlContent;

  } catch(err) {
    el.innerHTML = `<span style="color:#ff5252"><i class="fa-solid fa-triangle-exclamation"></i> æŸ¥è¯¢å¤±è´¥: ${err.message}</span>`;
  }
}

// --- åŠŸèƒ½ 3: åœ°å›¾æ˜¾ç¤º ---
let map = null, marker = null;
function updateMap(lat, lon, text) {
    const mapDiv = document.getElementById('map');
    mapDiv.style.display = 'block';
    if(!map) {
        map = L.map('map').setView([lat, lon], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { 
          attribution: '&copy; OpenStreetMap',
          maxZoom: 18 
        }).addTo(map);
    } else {
        map.setView([lat, lon], 13);
    }
    if(marker) map.removeLayer(marker);
    marker = L.marker([lat, lon]).addTo(map).bindPopup(`<b>${text}</b>`).openPopup();
    setTimeout(() => { map.invalidateSize(); }, 300);
}

// --- åŠŸèƒ½ 4: å†å²è®°å½• ---
let historyIPs=[];
function addHistory(ip){
  historyIPs = historyIPs.filter(item => item !== ip);
  historyIPs.unshift(ip);
  if(historyIPs.length > 8) historyIPs.pop();
  
  const listEl = document.getElementById('historyList');
  listEl.innerHTML = 'å†å²è®°å½•: ';
  historyIPs.forEach(item => {
    const span = document.createElement('span');
    span.textContent = item;
    span.className = 'history-tag';
    span.onclick = () => {
        document.getElementById('ipInput').value = item;
        queryIP();
    };
    listEl.appendChild(span);
  });
}

// --- åŠŸèƒ½ 5: è®¾å¤‡æ£€æµ‹ ---
function detectDevice() {
  const ua = navigator.userAgent;
  const el = document.getElementById("deviceInfo");
  let system="æœªçŸ¥ç³»ç»Ÿ", browser="æœªçŸ¥æµè§ˆå™¨";
  let sysIcon='<i class="fa-solid fa-desktop device-icon"></i>';
  let brIcon='<i class="fa-solid fa-globe device-icon"></i>';
  
  if(/Android/i.test(ua)){ system="Android"; sysIcon='<i class="fab fa-android device-icon"></i>'; }
  else if(/iPhone|iPad/i.test(ua)){ system="iOS"; sysIcon='<i class="fab fa-apple device-icon"></i>'; }
  else if(/Windows/i.test(ua)){ system="Windows"; sysIcon='<i class="fab fa-windows device-icon"></i>'; }
  else if(/Macintosh/i.test(ua)){ system="macOS"; sysIcon='<i class="fab fa-apple device-icon"></i>'; }

  if(/Chrome/i.test(ua)){ browser="Chrome"; brIcon='<i class="fab fa-chrome device-icon"></i>'; }
  else if(/Firefox/i.test(ua)){ browser="Firefox"; brIcon='<i class="fab fa-firefox device-icon"></i>'; }
  else if(/Safari/i.test(ua) && !/Chrome/i.test(ua)){ browser="Safari"; brIcon='<i class="fab fa-safari device-icon"></i>'; }

  el.innerHTML = `${sysIcon}${system} &nbsp;|&nbsp; ${brIcon}${browser}`;
}

// --- åˆå§‹åŒ– ---
function queryIP(){
  const ip=document.getElementById('ipInput').value.trim();
  if(!ip) return alert('è¯·è¾“å…¥ IP åœ°å€');
  fetchIPInfo(ip, document.getElementById('result'), true);
}

document.getElementById('ipInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') queryIP();
});

detectDevice();
fetchIPInfo(null, document.getElementById('myIpInfo'));
</script>
</body>
</html>
