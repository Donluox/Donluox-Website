<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>What Is My IP</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
body {
  background: #0d1117;
  color: #fff;
  font-family: 'Segoe UI', sans-serif;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  padding: 20px;
}
header {
  text-align: center;
  font-size: 2rem;
  color: #00e676;
  font-weight: 700;
  margin-bottom: 25px;
  text-shadow: 0 0 8px #00e676aa;
}
.card {
  background-color: #1e1e1e;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 0 12px rgba(0,0,0,0.5);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 15px rgba(0,230,118,0.4);
}
.card h2 {
  margin-bottom: 12px;
  color: #00e676;
  font-size: 1.3rem;
  display: flex;
  align-items: center;
}
.card h2 span {
  margin-right: 8px;
}
.input-group { margin-bottom: 15px; }
input {
  width: 100%;
  padding: 10px;
  border-radius: 6px;
  border: none;
  background-color: #222;
  color: #eee;
  font-size: 15px;
}
button {
  margin-top: 10px;
  padding: 10px 18px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background-color: #00c853;
  color: #fff;
  font-size: 15px;
  transition: background 0.3s ease;
}
button:hover { background-color: #00e676; }
.info { font-size: 15px; line-height: 1.6; }
.flag { width: 24px; height: 16px; vertical-align: middle; margin-left: 6px; border-radius: 2px; box-shadow: 0 0 3px rgba(0,0,0,0.3); }
.history-list { margin-top: 8px; font-size: 13px; color: #aaa; }
.history-list span {
  cursor: pointer;
  margin-right: 8px;
  padding: 2px 6px;
  border-radius: 4px;
  transition: 0.2s;
}
.history-list span:hover { background-color: #222; color: #00e676; }
.loading {
  display: inline-block;
  width: 18px; height: 18px;
  border: 3px solid #00e676;
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 1s linear infinite;
  vertical-align: middle;
  margin-left: 8px;
}
footer {
  text-align: center;
  margin-top: auto;
  color: #777;
  font-size: 13px;
  padding: 12px 0;
  border-top:1px solid #222;
}
.residential { color:#00e676; font-weight:bold; text-shadow:0 0 6px #00e676aa; }
.datacenter { color:#ff3d00; font-weight:bold; text-shadow:0 0 6px #ff3d00aa; }
.device-icon, .browser-icon { margin-right:6px; }
@keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<header>🌐 What Is My IP</header>

<div class="card">
  <h2><span>📍</span> 当前 IP 查询</h2>
  <div class="info" id="myIpInfo">查询中... <span class="loading" id="myIpLoading"></span></div>
</div>

<div class="card">
  <h2><span>🔎</span> 手动查询其他 IP</h2>
  <div class="input-group">
    <input type="text" id="ipInput" placeholder="输入 IP 地址">
    <button onclick="queryIP()">查询</button>
  </div>
  <div class="info" id="result"></div>
  <div class="history-list" id="historyList"></div>
</div>

<div class="card">
  <h2><span>🖥️</span> 用户设备 / 浏览器</h2>
  <div class="info" id="deviceInfo">加载中...</div>
</div>

<footer>联系我: <a href="mailto:abc@donluox.dpdns.org" style="color:#00e676; text-decoration:none;">abc@donluox.dpdns.org</a></footer>

<script>
function detectDevice() {
  const ua = navigator.userAgent;
  const el = document.getElementById("deviceInfo");
  let system="未知系统", browser="未知浏览器", sysIcon="", brIcon="";
  if(/Android/i.test(ua)){ system="Android"; sysIcon='<i class="fab fa-android device-icon"></i>'; }
  else if(/iPhone|iPad/i.test(ua)){ system="iOS"; sysIcon='<i class="fab fa-apple device-icon"></i>'; }
  else if(/Windows/i.test(ua)){ system="Windows"; sysIcon='<i class="fab fa-windows device-icon"></i>'; }
  else if(/Macintosh/i.test(ua)){ system="macOS"; sysIcon='<i class="fab fa-apple device-icon"></i>'; }

  if(/Chrome/i.test(ua)){ browser="Chrome"; brIcon='<i class="fab fa-chrome browser-icon"></i>'; }
  else if(/Firefox/i.test(ua)){ browser="Firefox"; brIcon='<i class="fab fa-firefox browser-icon"></i>'; }
  else if(/Safari/i.test(ua) && !/Chrome/i.test(ua)){ browser="Safari"; brIcon='<i class="fab fa-safari browser-icon"></i>'; }
  else if(/Edg/i.test(ua)){ browser="Edge"; brIcon='<i class="fab fa-edge browser-icon"></i>'; }

  el.innerHTML = `${sysIcon}${system} <br> ${brIcon}${browser}`;
}
detectDevice();

let historyIPs=[];
function addHistory(ip,typeClass){
  if(!historyIPs.find(item=>item.ip===ip)) historyIPs.push({ip,typeClass});
  const listEl=document.getElementById('historyList');
  listEl.innerHTML='';
  historyIPs.slice(-10).reverse().forEach(item=>{
    const span=document.createElement('span');
    span.textContent=item.ip;
    span.className=item.typeClass;
    span.onclick=()=>fetchIPInfo(item.ip,document.getElementById('result'));
    listEl.appendChild(span);
  });
}

async function fetchIPInfo(ip,el){
  el.innerHTML='查询中... <span class="loading"></span>';
  try{
    const url = ip?`https://ipapi.co/${ip}/json/`:'https://ipapi.co/json/';
    const res = await fetch(url);
    const data = await res.json();

    let isp=data.org||'未知';
    let ipType='住宅 IP', cssClass='residential';
    const cloudKeywords=['Amazon','AWS','Alibaba','Tencent','DigitalOcean','OVH','Google','Linode','Hetzner','Vultr'];
    for(let kw of cloudKeywords){ if(isp.includes(kw)){ ipType='机房 IP'; cssClass='datacenter'; break; } }

    let countryFlag=data.country_code?`<img class=\"flag\" src=\"https://flagcdn.com/24x18/${data.country_code.toLowerCase()}.png\" alt=\"${data.country_name}\">`:'';

    el.innerHTML=`
      <strong>IP:</strong> ${data.ip} <br>
      <strong>国家:</strong> ${data.country_name||'未知'} ${countryFlag} <br>
      <strong>城市:</strong> ${data.city||'未知'} <br>
      <strong>ISP/组织:</strong> ${isp} <br>
      <strong>ASN:</strong> ${data.asn||'未知'} <br>
      <strong>经纬度:</strong> ${data.latitude||'未知'}, ${data.longitude||'未知'} <br>
      <strong>时区:</strong> ${data.timezone||'未知'} <br>
      <strong>类型:</strong> <span class="${cssClass}">${ipType}</span>
    `;
    if(ip) addHistory(ip,cssClass);
  }catch(err){ el.innerHTML='查询失败: '+err.message; }
}

function queryIP(){
  const ip=document.getElementById('ipInput').value.trim();
  if(!ip) return alert('请输入 IP 地址');
  fetchIPInfo(ip,document.getElementById('result'));
}

fetchIPInfo(null,document.getElementById('myIpInfo'));
</script>
</body>
</html>
